專案架構文件：民間自主災害協作與智能媒合系統

**版本：** 0.1
**日期：** 2025年10月6日
**作者：** Gemini AI

---

**1. 專案概述**

*   **1.1. 專案目標與願景：**
    *   **目標：** 建立一個高效、透明、易於使用的民間自主災害協作與智能媒合系統，以應對如馬太鞍潰壩事件等複合型災害。
    *   **願景：** 透過分散式、去中心化的資訊媒合機制，賦能民間力量，使其能更有效率地支援官方救災，並在災害發生時，快速整合志工、物資、機具等民間資源，將需求與供給進行最佳匹配，提升整體救災效率與韌性。
*   **1.2. 專案範圍：**
    *   **In-scope：**
        *   提供災情、需求、供給、志工等資訊的發布、查詢、媒合功能。
        *   支援 Discord Bot 作為主要輸入介面，並提供 Web/App 介面。
        *   具備 AI Agent 輔助的智能媒合、排序、路徑推薦功能。
        *   提供 OpenAPI 格式的 API 供外部系統互動。
        *   數據以系統資料庫為主要儲存，並可定時匯出至 Google Sheets 作為公告或備用。
        *   考量高流量志工情境下的系統性能與擴展性。
    *   **Out-of-scope：**
        *   建立官方救災指揮體系或取代官方職能。
        *   涉及強制性權力（如強制撤離、交通管制）。
        *   初期不包含複雜的區塊鏈或分散式帳本技術（但保留未來擴展性）。
*   **1.3. 利害關係人分析：**
    *   **主要：** 受災民眾、個人志工、民間救災組織、社區領袖、志工團隊負責人。
    *   **次要：** 官方救災單位（作為資訊接收方或協作對象）、學術研究機構、媒體。
*   **1.4. 專案背景與動機：**
    *   鑑於馬太鞍潰壩事件等複合型災害的挑戰，以及民間力量在救災中的巨大潛力，本專案旨在透過技術手段，解決民間救災中資訊不對稱、協調困難、資源浪費等問題，提升民間自主救災的效率與智慧化程度。

**2. 系統架構總覽 (簡化版)**

*   **2.1. 高階架構圖：**
    *   (此處將會是一個圖示，描繪 Discord Bot 作為輸入，應用服務層處理業務邏輯，核心數據層儲存數據，AI Agent 進行智能分析，並透過 API 與外部系統互動，前端 Web/App 提供介面。)
*   **2.2. 主要模組與組件概述：**
    *   **核心數據層 (Core Data Layer)：** 集中儲存所有災情、需求、供給、志工等數據。
    *   **應用服務層 (Application Services Layer)：** 處理所有業務邏輯，包括數據的接收、處理、儲存、查詢，以及媒合邏輯。
    *   **AI Agent 模組 (AI Matching Agent Module)：** 執行智能媒合、數據分析、預測、異常偵測等任務。
    *   **使用者介面層 (User Interface Layer)：** 提供直觀、易用的介面，包括 Discord Bot 和 Web/App。
    *   **外部系統整合層 (External System Integration Layer)：** 透過 OpenAPI 格式的 API 與其他系統進行數據交換。
    *   **ATAK 整合模組 (ATAK Integration Module)：** 負責系統與 ATAK 之間的資訊橋接，將系統內部資訊轉換為 CoT (Cursor on Target) 格式並發布至 ATAK，同時也能接收和處理來自 ATAK 的 CoT 訊息。它將運用 TakSwak 專案實現與 ATAK 的互動。

**3. 功能需求**

*   **3.1. 資訊發布與回報功能 (強化地理與時效性)：**
    *   **災情回報模組：** 允許現場志工或受災民眾透過 Discord Bot 或 Web/App 即時回報災情（文字、照片、影片、GPS定位），可標註「可達性」與「時效性」。
    *   **需求發布模組：** 允許受災戶、避難所、民間組織發布物資、人力、機具、專業服務等需求，需明確標註「緊急程度」和「順序性」。
    *   **供給發布模組：** 允許個人、企業、民間組織發布可提供的物資、人力（志工專長）、機具、專業服務、住宿等供給。
    *   **交通路況回報模組：** 允許現場人員回報道路通行狀況，可手動標註路況數據。
    *   **安全警示發布模組：** 允許具備權限的民間組織或專家發布潛在危險區域、天氣預警等警示。
*   **3.2. 資訊查詢與篩選功能 (強化決策支援)：**
    *   **地圖視覺化模組：** 將所有資訊以地圖形式視覺化呈現，支援可達性圖層、優先級熱力圖、時間軸篩選。
    *   **列表查詢模組：** 提供多維度篩選功能，可依據關鍵字、類型、地點、時間、緊急程度、專長等條件查詢。
    *   **個人化資訊訂閱/通知模組：** 允許使用者訂閱特定區域、類型資訊，並接收即時通知。
*   **3.3. 媒合與協作功能 (強化動態調整)：**
    *   **智能路徑推薦：** AI Agent 考量路徑可達性，推薦最佳路徑或替代方案。
    *   **動態媒合調整：** 提供協調者介面調整任務優先級、重新分配資源，AI Agent 響應並重新評估媒合建議。
    *   **任務依賴關係管理：** 允許設定簡單的任務依賴關係。
    *   **溝通協作模組：** 提供內建的即時通訊功能。
*   **3.4. 信任與評價機制：**
    *   **志工/組織評價模組：** 允許對服務進行評價。
    *   **資訊驗證模組：** 透過多方交叉驗證或權限審核，確保資訊真實性。
*   **3.5. 數據分析與決策支援：**
    *   **儀表板模組：** 提供災情總覽、資源分佈、志工動態等關鍵數據。
    *   **趨勢分析模組：** 分析歷史數據，預測潛在需求。

**4. 非功能性需求**

*   **4.1. 效能：** 系統需能處理高併發請求，尤其在高流量志工情境下，確保媒合和查詢的響應速度。
*   **4.2. 安全性：** 數據傳輸加密、身份驗證、權限管理、防止惡意攻擊。
*   **4.3. 可靠性：** 系統高可用性，數據備份與恢復機制。
*   **4.4. 可擴展性：** 系統架構應易於水平擴展，以應對未來數據量和使用者增長。
*   **4.5. 易用性：** 介面直觀、操作簡便，降低志工和受災戶的使用門檻。
*   **4.6. 可維護性：** 程式碼清晰、文件完善，易於維護和迭代。
*   **4.7. 相容性：** 支援主流瀏覽器和行動裝置。

**5. 技術選型考量 (以最簡單技術，快速建立為原則)**

*   **後端開發語言與框架：** Python (FastAPI/Django) 或 Node.js (Express)，選擇團隊最熟悉、開發效率最高的。
*   **資料庫：** PostgreSQL 或 MySQL (優先使用雲端託管服務，如 AWS RDS, Google Cloud SQL)。
*   **前端開發：** React 或 Vue.js (搭配響應式設計或 PWA)。
*   **地圖服務：** Google Maps API 或 OpenStreetMap。
*   **AI/ML 相關：**
    *   **初期：** 基於規則的邏輯，或使用雲端 NLP API (如 Google Cloud Natural Language API)。
    *   **進階：** Python (Scikit-learn, NLTK) 進行簡單的文本分析和推薦。
*   **部署：** 雲端平台 (AWS, Google Cloud, Azure) 的 Compute Engine/EC2, Cloud SQL/RDS。
*   **通訊整合：** Discord API / Discord.js (Node.js) / Discord.py (Python) 進行 Bot 開發。
*   **訊息佇列：** RabbitMQ 或 Kafka (用於處理高併發的非同步任務，如通知)。
*   **緩存：** Redis (用於緩存熱門數據，提高讀取速度)。

**6. 資料模型設計**

*   **6.1. 主要實體與關係圖 (ERD) 概述：**
    *   **User (使用者):** 包含志工、受災戶、協調者等角色。
    *   **Volunteer (志工):** 繼承 User，包含專長、可服務時間、交通工具、歷史服務記錄、評價。
    *   **Disaster (災情):** 包含類型、描述、GPS、時間、可達性、驗證狀態。
    *   **Need (需求):** 包含類型、描述、GPS、時間、緊急程度、優先級、所需數量、任務依賴。
    *   **Supply (供給):** 包含類型、描述、GPS、時間、可提供數量、提供者。
    *   **Task (任務):** 媒合後的具體行動，包含任務ID、描述、地點、所需志工、所需物資、狀態、進度。
    *   **Matching (媒合記錄):** 記錄每次媒合的志工、任務、時間、結果、評價。
*   **6.2. 關鍵資料字典：** 定義各實體的欄位名稱、類型、是否必填、描述。

**7. 部署架構**

*   **7.1. 生產環境部署架構：**
    *   應用服務部署在雲端虛擬機或容器服務上。
    *   資料庫使用雲端託管服務。
    *   前端應用部署在 CDN 或靜態網站託管服務上。
*   **7.2. 開發/測試環境部署考量：** 建立與生產環境相似的環境，便於開發和測試。

**8. 開發流程與規範**

*   **8.1. 實施策略：循序漸進的數據與系統建構：**
    *   **第一階段：數據收集與初步媒合 (Google Forms/Sheets 為核心)：** 透過 Discord Bot 將數據寫入 Google Sheets，人工或半自動媒合。
    *   **第二階段：數據同步與系統資料庫建立：** 開發腳本將 Google Sheets 數據同步至關聯式資料庫。
    *   **第三階段：核心系統功能與 AI Agent 整合：** 開發專屬 Web/App 介面，AI Agent 介入媒合。
    *   **第四階段：系統優化、擴展與去中心化探索：** 性能優化、功能擴展，並評估區塊鏈等技術。
*   **8.2. Agent 的核心職責：** AI Agent 主要是讀取資訊，與資料庫溝通，提供智能輔助。
*   **8.3. 開發方法論：** 敏捷開發 (Scrum/Kanban)。
*   **8.4. 程式碼規範與風格指南：** 確保程式碼可讀性和可維護性。
*   **8.5. 版本控制策略：** Git Flow。

**9. 測試策略**

*   **9.1. 測試類型：** 單元測試、整合測試、系統測試、使用者驗收測試 (UAT)。
*   **9.2. 測試工具：** 選擇適合所選技術棧的測試框架。

**10. 風險評估與緩解**

*   **10.1. 技術風險：** 數據同步問題、AI Agent 準確性、系統性能瓶頸。
*   **10.2. 專案管理風險：** 志工開發者流失、需求變更頻繁。
*   **10.3. 營運風險：** 數據安全與隱私、系統穩定性、使用者接受度。
*   **10.4. 緩解措施：** 數據備份、逐步迭代、社群參與、完善文件。

**11. 救災 Agents 定義與職責**

*   **11.1. 資訊回報 Agent：** 現場志工、受災民眾，回報災情、路況。
*   **11.2. 需求發布 Agent：** 受災戶代表、避難所管理者，發布物資、人力需求。
*   **11.3. 供給提供 Agent：** 個人志工、企業捐贈者，發布可提供物資、專長。
*   **11.4. 資訊驗證 Agent：** 資深志工、社區領袖，核實資訊真實性。
*   **11.5. 媒合協調 Agent：** 民間組織協調者，人工確認、調整媒合。
*   **11.6. 後勤支援 Agent：** 專責後勤志工團隊，負責物資運輸、志工食宿。
*   **11.7. AI 媒合 Agent：** 系統智能組件，提供媒合建議、排序、路徑推薦。

**12. 媒合邏輯與 Agentic AI 應用 (高流量志工情境強化)**

*   **12.1. 數據基礎準備：** 數據清洗與標準化，數據模型設計，數據同步至系統資料庫。
*   **12.2. 定義媒合目標與評估標準：** 核心目標為最佳匹配，評估效率、準確性、覆蓋率。
*   **12.3. Agentic AI 媒合邏輯的應用：**
    *   **智能分流與推薦：** 根據志工/任務畫像、地理、專長、緊急程度進行實時匹配，並考慮負荷平衡。
    *   **優先級排序與動態調整：** 實時監控數據，動態計算任務優先級，響應策略調整。
    *   **快速任務領取與狀態更新：** 志工快速領取任務，AI Agent 自動確認與追蹤進度。
    *   **負荷平衡與資源優化：** 監測供需，預警失衡，建議分流。
*   **12.4. AI Agent 與人類 Agent 的協作：** AI 提供建議，人類決策，並透過回饋迴圈持續優化 AI。

**13. Discord 與自動化整合策略**

*   **13.1. Discord 在救災協作中的優勢：** 即時通訊、頻道管理、機器人自動化、社群熟悉度。
*   **13.2. Discord 與系統的整合策略：** 作為前端介面（數據輸入、任務領取）、通知與警示中心、協作與溝通平台。
*   **13.3. Discord Bot 的具體應用：** 數據收集 Bot、資訊查詢 Bot、通知與警示 Bot、志工管理 Bot。
*   **13.4. 整合技術考量：** Discord API、Google Sheets API、系統後端 API、Webhook。

**14. 數據同步的取捨與策略 (Discord Bot -> DB -> Google Sheets)**

*   **14.1. 設計優點：** 解決數據一致性、提升數據完整性、提高性能、統一輸入渠道、Google Sheets 角色明確。
*   **14.2. 潛在困難與挑戰：** Bot 開發維護複雜性、Discord 介面限制、數據匯出目的與頻率、外部系統同步複雜性、數據安全與權限。
*   **14.3. 改進建議：** 多渠道輸入考量、API 優先於 Google Sheets 進行外部同步、強化 Bot 錯誤處理與日誌、數據安全與權限細化、逐步迭代 Bot 功能。

**15. OpenAPI 格式 API 設計**

*   **15.1. OpenAPI API 的重要性：** 標準化、自動化文件、代碼生成、測試與驗證、促進生態系。
*   **15.2. 對系統架構的影響：** API 服務層的核心，API 閘道器。
*   **15.3. 技術選型考量：** 後端框架支持、API 文件工具、認證與授權機制。
*   **15.4. API 設計考量：** RESTful 原則、清晰資源設計、標準請求響應、錯誤處理、版本控制、數據模型定義。

---

**Review Feedback:**

*   需要能跟 atak 同步相關的資訊，作為資訊發佈的一環
* **溝通協作模組：** 提供內建的即時通訊功能。: 應使用 discord 內建，讓使用者自行溝通
* 8.1 的第一階段應該是錯誤的。這是舊的資訊
* 會需要一個章節，作為 discord 裡面的討論群設計，使用規範。在某些討論群，會允許使用者自建立版
---